<!DOCTYPE html>
<html lang="pt-br" ng-app="orbitasApp">
<head>
	<meta charset="utf-8">
	<title>Simulador de Corpos Celestes</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="Romenig da Silva Ribeiro">

	<!--link rel="stylesheet/less" href="less/bootstrap.less" type="text/css" /-->
	<!--link rel="stylesheet/less" href="less/responsive.less" type="text/css" /-->
	<!--script src="js/less-1.3.3.min.js"></script-->
	<!--append ‘#!watch’ to the browser URL, then refresh the page. -->

	<link href="../css/bootstrap.min.css" rel="stylesheet">

	<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
<script src="js/html5shiv.js"></script>
<![endif]-->

<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/bootstrap.min.js"></script>
<script type="text/javascript" src="../js/paper.min.js"></script>
<script type="text/javascript" src="../js/angular.min.js"></script>
<script type="text/javascript" src="./orbitas.js"></script>
<style>

body{
	padding: 20px;
	background-color: #22313F;
}



</style>

</head>
<body>
	<script type="text/paperscript" canvas="meuCanvas">
	
	var corpos;

	$(function(){
		inicializacao();
		instalarGlobais();
	});

	function instalarGlobais(){
		window.globais = {
			adicionarCorpo: function(corpo){
				corpos.push(new Path.Circle({
					center: [corpo.posicao.x, corpo.posicao.y],
					radius: corpo.massa/10,
					strokeColor: corpo.cor,
				}));
				paper.view.draw();
			},

			removerCorpo: function(index){
				corpos[index].remove();
				corpos.splice(index, 1);
				paper.view.draw();
			}

		};
	}

	function inicializacao(){
		corpos = new Array();
		paper.view.setCenter(new Point(0,0));
	}

	//vetores
		var values = {
		fixLength: false,
		fixAngle: false,
		showCircle: false,
		showAngleLength: true,
		showCoordinates: false
	};

	var vectorStart, vector, vectorPrevious;
	var vectorItem, items, dashedItems;

	function processVector(event, drag) {
		vector = event.point - vectorStart;
		if (vectorPrevious) {
			if (values.fixLength && values.fixAngle) {
				vector = vectorPrevious;
			} else if (values.fixLength) {
				vector.length = vectorPrevious.length;
			} else if (values.fixAngle) {
				vector = vector.project(vectorPrevious);
			}
		}
		drawVector(drag);
	}

	function drawVector(drag) {
		if (items) {
			for (var i = 0, l = items.length; i < l; i++) {
				items[i].remove();
			}
		}
		if (vectorItem)
			vectorItem.remove();
		items = [];
		var arrowVector = vector.normalize(10);
		var end = vectorStart + vector;
		vectorItem = new Group([
			new Path([vectorStart, end]),
			new Path([
				end + arrowVector.rotate(135),
				end,
				end + arrowVector.rotate(-135)
			])
		]);
		vectorItem.strokeWidth = 0.75;
		vectorItem.strokeColor = '#e4141b';
		// Display:
		dashedItems = [];
		// Draw Circle
		if (values.showCircle) {
			dashedItems.push(new Path.Circle({
				center: vectorStart,
				radius: vector.length
			}));
		}
		// Draw Labels
		if (values.showAngleLength) {
			//ROMENIG drawAngle(vectorStart, vector, !drag);
			if (!drag)
				drawLength(vectorStart, end, vector.angle < 0 ? -1 : 1, true);
		}
		var quadrant = vector.quadrant;
		if (values.showCoordinates && !drag) {
			drawLength(vectorStart, vectorStart + [vector.x, 0],
					[1, 3].indexOf(quadrant) != -1 ? -1 : 1, true, vector.x, 'x: ');
			drawLength(vectorStart, vectorStart + [0, vector.y], 
					[1, 3].indexOf(quadrant) != -1 ? 1 : -1, true, vector.y, 'y: ');
		}
		for (var i = 0, l = dashedItems.length; i < l; i++) {
			var item = dashedItems[i];
			item.strokeColor = 'black';
			item.dashArray = [1, 2];
			items.push(item);
		}
		// Update palette
		values.x = vector.x;
		values.y = vector.y;
		values.length = vector.length;
		values.angle = vector.angle;
	}

	function drawLength(from, to, sign, label, value, prefix) {
		var lengthSize = 5;
		if ((to - from).length < lengthSize * 4)
			return;
		var vector = to - from;
		var awayVector = vector.normalize(lengthSize).rotate(90 * sign);
		var upVector = vector.normalize(lengthSize).rotate(45 * sign);
		var downVector = upVector.rotate(-90 * sign);
		var lengthVector = vector.normalize(
				vector.length / 2 - lengthSize * Math.sqrt(2));
		var line = new Path();
		line.add(from + awayVector);
		line.lineBy(upVector);
		line.lineBy(lengthVector);
		line.lineBy(upVector);
		var middle = line.lastSegment.point;
		line.lineBy(downVector);
		line.lineBy(lengthVector);
		line.lineBy(downVector);
		dashedItems.push(line);
		if (label) {
			// Length Label
			var textAngle = Math.abs(vector.angle) > 90
					? textAngle = 180 + vector.angle : vector.angle;
			// Label needs to move away by different amounts based on the
			// vector's quadrant:
			var away = (sign >= 0 ? [1, 4] : [2, 3]).indexOf(vector.quadrant) != -1
					? 8 : 0;
			value = value || vector.length;
			var text = new PointText({
				point: middle + awayVector.normalize(away + lengthSize),
				content: "F = "+(prefix || '') + Math.floor(value * 1000) / 1000 + " N",
				fillColor: 'black',
				justification: 'center'
			});
			text.rotate(textAngle);
			items.push(text);
		}
	}

	var dashItem;

	function onMouseDown(event) {
		var end = vectorStart + vector;
		var create = false;
		if (event.modifiers.shift && vectorItem) {
			vectorStart = end;
			create = true;
		} else if (vector && (event.modifiers.option
				|| end && end.getDistance(event.point) < 10)) {
			create = false;
		} else {
			vectorStart = event.point;
		}
		if (create) {
			dashItem = vectorItem;
			vectorItem = null;
		}
		processVector(event, true);
	}

	function onMouseDrag(event) {
		if (!event.modifiers.shift && values.fixLength && values.fixAngle)
			vectorStart = event.point;
		processVector(event, event.modifiers.shift);
	}

	function onMouseUp(event) {
		processVector(event, false);
		if (dashItem) {
			dashItem.dashArray = [1, 2];
			dashItem = null;
		}
		vectorPrevious = vector;
	}

	</script>
	<div ng-controller="OrbitasController">
		<div class="panel panel-default">
			<div class="panel-heading">Simulador de órbitas
			</div>
			<div class="panel-body">
				<div class="container">
					<div class="row">
						<div class="col-md-9">
							<canvas id="meuCanvas" style="width:640px;height:480px;background-color='black';"></canvas>
						</div>
						<div class="col-md-3">
							<div class="btn-group btn-group-justified">
						    	<a class="btn btn-success" role="button"><span class="glyphicon glyphicon-play" ></span></a>
						    	<a class="btn btn-warning" role="button"><span class="glyphicon glyphicon-pause" ></span></a>
						    	<a class="btn btn-danger" role="button"><span class="glyphicon glyphicon-refresh" ></span></a>
						    </div>
							</br>
							<button type="button" class="btn btn-primary btn-block" ng-click="adicionarCorpo();">
								<span class="glyphicon glyphicon-plus"></span>&nbsp; Novo corpo celeste
							</button></br>
							<div class="row">
								<div ng-repeat="corpo in corpos">
									<div class="col-md-6 column">
										<span class="">{{corpo.nome}}</span>
									</div>
									<div class="col-md-4 column">
										<span class="">{{corpo.massa}}</span>
									</div>
									<div class="col-md-2 column">
										<a ng-click="removerCorpo(corpo);" role="button"><span class="glyphicon glyphicon-trash" ></span></a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
